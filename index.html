<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Packet Viewer</title>

  <style>
    body { font-family: sans-serif; margin: 22px; background: #f1f2f6; }
    .content-section { padding: 16px; background: #fff; border-radius: 8px; box-shadow: 0 2px 6px #d2d4db55; }
    .tab-bar { display: flex; margin-bottom: 15px; }
    .tab-bar button { padding: 10px 22px; margin-right: 5px; background: #dee2ef; border: none; border-radius: 5px 5px 0 0; cursor: pointer; }
    .tab-bar button.active { background: #fff; font-weight: bold; border-bottom: 2px solid #333; }

    /* Flashcards */
    .flashcard-box { display: flex; flex-wrap: wrap; gap: 1rem; }
    .flashcard { background: #145; color: #fff; width: 320px; min-height: 200px; border-radius: 10px; perspective: 700px; cursor: pointer; padding: 1em; }
    .flashcard-inner { width: 100%; height: 100%; transition: transform .5s; transform-style: preserve-3d; position: relative; }
    .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
    .flashcard-front, .flashcard-back {
      position: absolute; width: 100%; height: auto; display: flex; align-items: center;
      justify-content: center; backface-visibility: hidden; border-radius: 10px; padding: 1em;
      text-align: center; white-space: normal; overflow: visible;
    }
    .flashcard-back { background: #fff; color: #222; transform: rotateY(180deg); }

    /* Drag & Drop */
    .drop-zone {
      border: 2px dashed #888;
      padding: 20px;
      border-radius: 10px;
      background: #fafafa;
      text-align: center;
      margin-bottom: 15px;
      transition: background .3s, border .3s;
    }
    .drop-zone.dragover {
      border-color: #333;
      background: #e7f3ff;
    }

    /* General */
    .h1 { font-size: 1.9em; font-weight: bold; margin: 0.6em 0; }
    .h2 { font-size: 1.4em; font-weight: bold; margin: 0.6em 0; }
    .h3 { font-size: 1.15em; font-weight: bold; margin: 0.5em 0; }

    table { border-collapse: collapse; width: 100%; margin: 1.2em 0; }
    th, td { border: 1px solid #ccd; padding: 8px; }
    th { background: #f5f6fd; }
  </style>
</head>

<body>
<h1>Study Packet Viewer</h1>

<!-- Drag & Drop Upload -->
<div class="drop-zone" id="dropZone">Drag & Drop JSON files here<br>(Introduction, Lesson, Quiz, Flashcards)</div>

<!-- Upload Inputs -->
<div>
  <input type="file" id="fileInput" multiple />
</div>
<br>

<!-- Tabs -->
<div class="tab-bar">
  <button data-tab="Introduction">Introduction</button>
  <button data-tab="Lesson">Lesson</button>
  <button data-tab="Flashcard">Flashcards</button>
  <button data-tab="Quiz">Quiz</button>
</div>

<div id="app-root" class="content-section"></div>

<script>
// DATA Storage
const DATA = { Introduction: null, Lesson: null, Flashcard: null, Quiz: null };

// Drag & Drop
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');

dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('dragover');
});

dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', () => handleFiles(fileInput.files));

function handleFiles(files) {
  [...files].forEach(async (file) => {
    const name = file.name.toLowerCase();
    const text = await file.text();
    try {
      const json = JSON.parse(text);
      if (name.includes('intro')) DATA.Introduction = json;
      else if (name.includes('lesson')) DATA.Lesson = json;
      else if (name.includes('flash')) DATA.Flashcard = json;
      else if (name.includes('quiz')) DATA.Quiz = json;
      alert(`${file.name} loaded successfully`);
      renderActiveTab();
    } catch {
      alert(`Invalid JSON in ${file.name}`);
    }
  });
}

// DOM helper
function el(tag, attrs, ...children) {
  const node = document.createElement(tag);
  if (attrs) for (let k in attrs) node.setAttribute(k, attrs[k]);
  children.flat().forEach(c => node.append(typeof c === 'string' ? document.createTextNode(c) : c));
  return node;
}

// Rich renderer (same as previous version)
function renderRich(children) {
  if (!children) return [];
  return children.map(ch => {
    if (ch.text !== undefined) return document.createTextNode(ch.text);
    if (ch.type === 'paragraph') return el('p', null, renderRich(ch.children));
    if (['h1','h2','h3'].includes(ch.type)) return el('div', {class: ch.type}, renderRich(ch.children));
    return document.createTextNode('');
  });
}

// Flashcards
function flashcardComponent(data) {
  if (!data) return 'Upload Flashcard JSON first.';
  const deck = data.contents.find(c => c.type === 'flash-cards');
  if (!deck) return 'No flashcards found.';

  let state = new Set();

  return el("div", null,
    ...deck.children.map((card, i) => {
      const flipped = state.has(i);
      const wrapper = el('div', { class: 'flashcard' });
      wrapper.onclick = () => { flipped ? state.delete(i) : state.add(i); renderActiveTab(); };

      const inner = el('div', { class: 'flashcard-inner' });

      const front = el('div', { class: 'flashcard-front' }, ...renderRich(card.children[0]?.children));
      const back = el('div', { class: 'flashcard-back' }, ...renderRich(card.children[1]?.children));

      inner.append(front, back);
      wrapper.append(inner);

      if (flipped) wrapper.classList.add('flipped');

      return wrapper;
    })
  );
}

// Dummy components for rest
function introComponent(d) { return d ? el('div', null, ...renderRich(d.contents)) : 'Upload Introduction JSON'; }
function lessonComponent(d) { return d ? el('div', null, ...renderRich(d.contents)) : 'Upload Lesson JSON'; }
function quizComponent(d) { return d ? el('div', null, JSON.stringify(d)) : 'Upload Quiz JSON'; }

// Tab switching
let activeTab = 'Introduction';

document.querySelectorAll('.tab-bar button').forEach(btn => {
  btn.addEventListener('click', () => {
    activeTab = btn.dataset.tab;
    renderActiveTab();
  });
});

function renderActiveTab() {
  const root = document.getElementById('app-root');
  root.innerHTML = '';

  let view = null;
  if (activeTab === 'Introduction') view = introComponent(DATA.Introduction);
  if (activeTab === 'Lesson') view = lessonComponent(DATA.Lesson);
  if (activeTab === 'Flashcard') view = flashcardComponent(DATA.Flashcard);
  if (activeTab === 'Quiz') view = quizComponent(DATA.Quiz);

  root.append(view);
}

renderActiveTab();
</script>

</body>
</html>